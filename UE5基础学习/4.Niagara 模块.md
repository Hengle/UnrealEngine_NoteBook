模块是Niagara中效果的基础构建块。你可以将模块添加到组中来形成堆栈。模块按照自上而下的顺序处理。

你可以将模块视为能够执行某些`数学运算的容器`。你需要将数据传送到模块中，然后在模块中对`该数据执行一些数学运算`，然后在模块结束时将该数据重新写出。

模块是使用`高级着色语言(HLSL)`进行构建的，但是可以使用节点在图表中以可视方式进行构建。你可以创建函数（包括输入），或者写入到某个数值或参数贴图中。你甚至可以使用图表中的 **CustomHLSL** 节点，以内联方式编写HLSL代码。

你可以`双击Niagara中发射器`内部的模块，以查看在模块内部发生的数学运算。你甚至可以复制和创建自己的模块。例如，双击"添加速度（Add Velocity）"模块来查看其内部，则可以看到数据流。

![[Pasted image 20230227205657.jpg|L|1000]]


# 关于Niagara的部分属性理解：

## 阶段、组、命名空间及数据封装

通过将各个模块添加到 _组_（系统、发射器或粒子）的 _阶段_（更新、生成、事件或模拟），可控制模块执行时间及模块处理的数据。堆栈组关联 **命名空间**；此类命名空间将定义该组中的模块可读取或写入的数据。

> 命名空间：更像是粒子中的各个参数集。他们有各自的作用域，只有在作用域范围内的才能起到作用。并且他们是一种嵌套的关系。

例如，**系统** 组中执行的模块可读写系统命名空间的参数，但`只能读取`引擎或用户命名空间中的参数。沿堆栈从系统组向下执行至发射器组时，**发射器** 组中执行的模块可读写发射器命名空间中的参数，但`只能读取`系统、引擎和用户命名空间中的参数。**粒子** 组中的模块`只能读取`系统和发射器命名空间的参数。

由于发射器组中的模块可读取系统命名空间中的参数，因此系统组中的模块可执行一次与所有发射器相关的模拟，并由各个发射器中的发射器组模块读取模拟结果（存储在系统命名空间中）。这也适用于粒子组中的模块，其可读取系统和发射器命名空间中的参数。下表清楚地列出了它们之间的关系。

![[Pasted image 20230301131424.png]]

# Niagara中的世界坐标
**大型世界坐标** 现已在虚幻引擎中实现。要理解它在主引擎中的实现，请参阅此[大型世界坐标](https://docs.unrealengine.com/5.0/zh-CN/large-world-coordinates-in-unreal-engine-5)页面。简而言之，数据类型FVector现在是 `double` 而不是 `float` 。
Niagara实现与主引擎的实现不同。因为需要高效执行计算，无论是在CPU还是GPU上，都存在限制，导致无法处理double。Niagara中改用了一种存储位置数据的新方法。
世界大到一定程度时，`将划分为图块网格`。想象一下空间中的位置，它在图块单元中有自己的相对位置，还有该图块在世界中的位置。请参见下图，了解其外观的概念呈现
![[Pasted image 20230301132517.jpg|L|800]]


## UE4和UE5中的位置数据
UE4和UE5之间的主要差异是粒子位置数据的存储方式，即 `Particles.Position` 。
![[Pasted image 20230301141609.png|1000|L]]

